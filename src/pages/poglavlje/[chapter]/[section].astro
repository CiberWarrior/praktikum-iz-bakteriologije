---
import ChapterLayout from '../../../components/ChapterLayout.astro';
import ChapterNavigation from '../../../components/ChapterNavigation.astro';
import ChapterContent from '../../../components/mdx/ChapterContent.astro';
import { loadSection, getChapterNavigation, generateBreadcrumbPath } from '../../../utils/mdxLoader';

export async function getStaticPaths() {
  // Ovdje bi trebali generirati sve moguće putanje
  // Za sada ćemo kreirati primjer za poglavlje 16
  return [
    { params: { chapter: '16', section: 'bakterije-mlijecne-fermentacije' } },
    { params: { chapter: '16', section: 'vjezba-16' } },
    // Dodajte ostale sekcije prema potrebi
  ];
}

const { chapter, section } = Astro.params;
const chapterNumber = parseInt(chapter!);
const sectionSlug = section!;

try {
  const mdxContent = loadSection(chapterNumber, sectionSlug);
  const navigation = getChapterNavigation(chapterNumber);
  const breadcrumbPath = generateBreadcrumbPath(chapterNumber, mdxContent.frontmatter.title);
  
  const title = mdxContent.frontmatter.title || sectionSlug.replace(/-/g, ' ');
  const description = mdxContent.frontmatter.description || `Sadržaj poglavlja ${chapterNumber} - ${title}`;
  const primaryColor = navigation.current.color;
} catch (error) {
  return Astro.redirect('/404');
}
---

<ChapterLayout 
  title={title} 
  description={description} 
  chapterNumber={chapterNumber}
  primaryColor={primaryColor}
  prevLink={navigation.prev ? `/poglavlje-${navigation.prev.number}/` : undefined}
  nextLink={navigation.next ? `/poglavlje-${navigation.next.number}/` : undefined}
  prevText={navigation.prev ? `← Poglavlje ${navigation.prev.number}` : undefined}
  nextText={navigation.next ? `Poglavlje ${navigation.next.number} →` : undefined}
  ctaTitle="Nastavi na sljedeće poglavlje" 
  ctaDescription={navigation.next ? `Nastavite s učenjem i upoznajte ${navigation.next.title}.` : undefined}
  ctaPrimaryText={navigation.next ? `Poglavlje ${navigation.next.number}` : undefined}
  ctaPrimaryLink={navigation.next ? `/poglavlje-${navigation.next.number}/` : undefined}
  ctaSecondaryText="Povratak na pregled" 
  ctaSecondaryLink={`/poglavlje-${chapterNumber}/`}
  showBreadcrumb={true}
  breadcrumbPath={breadcrumbPath}
>
  <!-- Navigacija kroz poglavlje -->
  <ChapterNavigation 
    chapterNumber={chapterNumber} 
    currentSection={sectionSlug} 
    chapterTitle={navigation.current.title}
  />

  <!-- Sadržaj poglavlja -->
  <ChapterContent 
    content={mdxContent.content}
    chapterNumber={chapterNumber}
    sectionName={title}
    primaryColor={primaryColor}
  />

</ChapterLayout>
